<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <script src="{{vscodeElementsScript}}" type="module"></script>
  </head>
  <body>
    <vscode-table bordered-rows>
      <vscode-table-header slot="header" id="table-header">
      </vscode-table-header>
      <vscode-table-body slot="body" id="table-body">
      </vscode-table-body>
    </vscode-table>
    <script>
      const createHeader = (message) => {
        const header = document.getElementById("table-header");
        header.innerHTML = "";

        for (const v of Object.keys(message.data[0])) {
          header.innerHTML += `<vscode-table-header-cell>${v}</vscode-table-header-cell>`;
        }
      };

      const createBody = (message) => {
        const body = document.getElementById("table-body");
        body.innerHTML = "";

        for (const row of message.data.slice(0, 100)) {
          const r = document.createElement("vscode-table-row");

          for (const v of Object.values(row)) {
            r.innerHTML += `<vscode-table-cell>${v}</vscode-table-cell>`;
          }

          body.appendChild(r);
        }
      };

      window.addEventListener("message", (event) => {
        const message = event.data;

        console.log("Received message:", message);

        if (message.type === "setTableData") {
          createHeader(message);
          createBody(message);
        }
      });
    </script>
  </body>
</html>
